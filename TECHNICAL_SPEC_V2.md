# NEXO Platform V2.0 ìƒì„¸ ê¸°ìˆ  ëª…ì„¸ì„œ

## ğŸ“‹ ëª©ì°¨
1. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
2. [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ](#ë°ì´í„°ë² ì´ìŠ¤-ìŠ¤í‚¤ë§ˆ)
3. [API ì„¤ê³„](#api-ì„¤ê³„)
4. [ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬](#ì¸ì¦-ë°-ê¶Œí•œ-ê´€ë¦¬)
5. [í¬ì¸íŠ¸ ì‹œìŠ¤í…œ ìƒì„¸ ì„¤ê³„](#í¬ì¸íŠ¸-ì‹œìŠ¤í…œ-ìƒì„¸-ì„¤ê³„)
6. [ì•Œë¦¼ ì‹œìŠ¤í…œ ì„¤ê³„](#ì•Œë¦¼-ì‹œìŠ¤í…œ-ì„¤ê³„)
7. [íŒŒì¼ ì—…ë¡œë“œ ë° ìŠ¤í† ë¦¬ì§€](#íŒŒì¼-ì—…ë¡œë“œ-ë°-ìŠ¤í† ë¦¬ì§€)

---

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend (Netlify)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  index.html  â”‚  â”‚  admin.html  â”‚  â”‚  member.html â”‚ â”‚
â”‚  â”‚  (ì •ì  í˜ì´ì§€) â”‚  â”‚  (ê´€ë¦¬ì)    â”‚  â”‚  (íšŒì› ì „ìš©) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         JavaScript (Vanilla JS / React)         â”‚   â”‚
â”‚  â”‚  - EditionManager                               â”‚   â”‚
â”‚  â”‚  - AuthManager                                  â”‚   â”‚
â”‚  â”‚  - PointManager                                 â”‚   â”‚
â”‚  â”‚  - CommunityManager                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ HTTPS
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Backend Services (Supabase)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Auth API   â”‚  â”‚   Database   â”‚  â”‚   Storage    â”‚ â”‚
â”‚  â”‚  (ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸) â”‚  â”‚ (PostgreSQL) â”‚  â”‚   (íŒŒì¼ ì €ì¥) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Edge Functionsâ”‚  â”‚  Realtime    â”‚  â”‚   Triggers   â”‚ â”‚
â”‚  â”‚  (ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜) â”‚  â”‚  (ì‹¤ì‹œê°„)    â”‚  â”‚  (ìë™ ì‹¤í–‰)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ API
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              External Services                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ì•Œë¦¼í†¡ API   â”‚  â”‚  Google Sheetsâ”‚  â”‚  ì¹´ì¹´ì˜¤ API  â”‚ â”‚
â”‚  â”‚  (Solapi)    â”‚  â”‚  (ì£¼ë¬¸ ë°ì´í„°) â”‚  â”‚  (ë¡œê·¸ì¸)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê¸°ìˆ  ìŠ¤íƒ

#### í”„ë¡ íŠ¸ì—”ë“œ
- **í˜„ì¬**: HTML5, CSS3, Vanilla JavaScript
- **í–¥í›„ ê³ ë ¤**: React/Next.js (ê·œëª¨ í™•ëŒ€ ì‹œ)

#### ë°±ì—”ë“œ
- **Supabase**: Backend-as-a-Service
  - PostgreSQL ë°ì´í„°ë² ì´ìŠ¤
  - ì¸ì¦ ì‹œìŠ¤í…œ (Auth)
  - íŒŒì¼ ìŠ¤í† ë¦¬ì§€ (Storage)
  - ì‹¤ì‹œê°„ ê¸°ëŠ¥ (Realtime)
  - Edge Functions (ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜)

#### í˜¸ìŠ¤íŒ…
- **Netlify**: ì •ì  ì‚¬ì´íŠ¸ + Functions
- **Supabase**: ë°±ì—”ë“œ ì¸í”„ë¼

#### ì™¸ë¶€ ì„œë¹„ìŠ¤
- **ì•Œë¦¼í†¡**: Solapi ë˜ëŠ” ì•Œë¦¬ê³ 
- **Google Sheets**: ì£¼ë¬¸ ë°ì´í„° ë°±ì—… (ê¸°ì¡´ ìœ ì§€)

---

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### í…Œì´ë¸” êµ¬ì¡°

#### 1. users (ì‚¬ìš©ì)

```sql
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  email TEXT UNIQUE,
  name TEXT NOT NULL,
  academy_name TEXT,
  phone TEXT,
  role TEXT DEFAULT 'subscriber' CHECK (role IN ('subscriber', 'admin', 'verified_buyer')),
  referrer_code TEXT, -- ìœ ì… ê²½ë¡œ (ê¸°ì‚¬ë‹˜ ì½”ë“œ ë“±)
  subscription_status TEXT DEFAULT 'active' CHECK (subscription_status IN ('active', 'inactive', 'cancelled')),
  subscription_started_at TIMESTAMP,
  total_points INTEGER DEFAULT 0,
  current_level TEXT DEFAULT 'bronze' CHECK (current_level IN ('bronze', 'silver', 'gold', 'platinum')),
  notification_enabled BOOLEAN DEFAULT true,
  notification_method TEXT DEFAULT 'sms' CHECK (notification_method IN ('sms', 'kakao', 'email')),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  last_login_at TIMESTAMP
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_referrer_code ON users(referrer_code);
CREATE INDEX idx_users_subscription_status ON users(subscription_status);
```

#### 2. point_logs (í¬ì¸íŠ¸ ë‚´ì—­)

```sql
CREATE TABLE point_logs (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  amount INTEGER NOT NULL, -- ì–‘ìˆ˜(ì ë¦½) ë˜ëŠ” ìŒìˆ˜(ì‚¬ìš©)
  action_type TEXT NOT NULL, -- 'read_weekly', 'write_review', 'write_comment', 'event_entry', 'purchase'
  description TEXT,
  related_id UUID, -- ê´€ë ¨ í•­ëª© ID (ê²Œì‹œê¸€, ì´ë²¤íŠ¸ ë“±)
  created_at TIMESTAMP DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_point_logs_user_id ON point_logs(user_id);
CREATE INDEX idx_point_logs_action_type ON point_logs(action_type);
CREATE INDEX idx_point_logs_created_at ON point_logs(created_at DESC);
```

#### 3. posts (ê²Œì‹œê¸€)

```sql
CREATE TABLE posts (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  type TEXT NOT NULL CHECK (type IN ('review', 'community', 'question')),
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  images TEXT[], -- ì´ë¯¸ì§€ URL ë°°ì—´
  is_verified BOOLEAN DEFAULT false, -- êµ¬ë§¤ ì¸ì¦ ì—¬ë¶€
  is_best BOOLEAN DEFAULT false, -- ë² ìŠ¤íŠ¸ í›„ê¸° ì—¬ë¶€
  likes_count INTEGER DEFAULT 0,
  comments_count INTEGER DEFAULT 0,
  views_count INTEGER DEFAULT 0,
  status TEXT DEFAULT 'published' CHECK (status IN ('draft', 'published', 'deleted')),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_posts_user_id ON posts(user_id);
CREATE INDEX idx_posts_type ON posts(type);
CREATE INDEX idx_posts_is_best ON posts(is_best) WHERE is_best = true;
CREATE INDEX idx_posts_created_at ON posts(created_at DESC);
```

#### 4. comments (ëŒ“ê¸€)

```sql
CREATE TABLE comments (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  post_id UUID NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  content TEXT NOT NULL,
  parent_id UUID REFERENCES comments(id), -- ëŒ€ëŒ“ê¸€ ì§€ì›
  likes_count INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_comments_post_id ON comments(post_id);
CREATE INDEX idx_comments_user_id ON comments(user_id);
```

#### 5. post_likes (ê²Œì‹œê¸€ ì¢‹ì•„ìš”)

```sql
CREATE TABLE post_likes (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  post_id UUID NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(post_id, user_id) -- ì¤‘ë³µ ì¢‹ì•„ìš” ë°©ì§€
);
```

#### 6. events (ì´ë²¤íŠ¸)

```sql
CREATE TABLE events (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  title TEXT NOT NULL,
  description TEXT,
  image_url TEXT,
  entry_cost_points INTEGER DEFAULT 0, -- ì‘ëª¨ ë¹„ìš© (í¬ì¸íŠ¸)
  max_entries INTEGER, -- ìµœëŒ€ ì‘ëª¨ ì¸ì›
  prize_description TEXT, -- ê²½í’ˆ ì„¤ëª…
  start_date TIMESTAMP NOT NULL,
  end_date TIMESTAMP NOT NULL,
  draw_date TIMESTAMP, -- ì¶”ì²¨ì¼
  status TEXT DEFAULT 'upcoming' CHECK (status IN ('upcoming', 'active', 'ended', 'drawn')),
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### 7. event_entries (ì´ë²¤íŠ¸ ì‘ëª¨)

```sql
CREATE TABLE event_entries (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  event_id UUID NOT NULL REFERENCES events(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  points_used INTEGER NOT NULL,
  is_winner BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(event_id, user_id) -- ì¤‘ë³µ ì‘ëª¨ ë°©ì§€
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_event_entries_event_id ON event_entries(event_id);
CREATE INDEX idx_event_entries_user_id ON event_entries(user_id);
```

#### 8. orders (ì£¼ë¬¸/ìƒë‹´ ì‹ ì²­)

```sql
CREATE TABLE orders (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id), -- êµ¬ë…ìì¼ ê²½ìš°
  customer_name TEXT NOT NULL,
  academy_name TEXT,
  phone TEXT NOT NULL,
  email TEXT,
  referrer_code TEXT, -- ìœ ì… ê²½ë¡œ
  product_interest TEXT, -- ê´€ì‹¬ ì œí’ˆ
  size TEXT, -- ì¸ì¹˜
  mount_type TEXT, -- ì„¤ì¹˜ ë°©ì‹
  quantity INTEGER,
  unit_price INTEGER,
  total_price INTEGER,
  discount_amount INTEGER DEFAULT 0, -- í• ì¸ ê¸ˆì•¡
  discount_reason TEXT, -- í• ì¸ ì‚¬ìœ  (êµ¬ë…ì íŠ¹ê°€ ë“±)
  status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'contacted', 'quoted', 'purchased', 'cancelled')),
  source TEXT DEFAULT 'weekly_nexo' CHECK (source IN ('weekly_nexo', 'direct', 'referral')),
  notes TEXT, -- ë©”ëª¨
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_referrer_code ON orders(referrer_code);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_created_at ON orders(created_at DESC);
```

#### 9. downloads (ë‹¤ìš´ë¡œë“œ ì´ë ¥)

```sql
CREATE TABLE downloads (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  file_name TEXT NOT NULL,
  file_url TEXT NOT NULL,
  file_type TEXT, -- 'pdf', 'excel', 'image'
  category TEXT, -- 'premium', 'template', 'guide'
  downloaded_at TIMESTAMP DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_downloads_user_id ON downloads(user_id);
CREATE INDEX idx_downloads_downloaded_at ON downloads(downloaded_at DESC);
```

#### 10. referral_codes (ì¶”ì²œì¸ ì½”ë“œ)

```sql
CREATE TABLE referral_codes (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  code TEXT UNIQUE NOT NULL, -- ê³ ìœ  ì½”ë“œ
  owner_type TEXT NOT NULL CHECK (owner_type IN ('staff', 'member', 'partner')),
  owner_id TEXT, -- ì†Œìœ ì ID (ê¸°ì‚¬ë‹˜ ID, íšŒì› ID ë“±)
  owner_name TEXT, -- ì†Œìœ ì ì´ë¦„
  total_referrals INTEGER DEFAULT 0, -- ì´ ì¶”ì²œ ìˆ˜
  total_points_given INTEGER DEFAULT 0, -- ì§€ê¸‰í•œ ì´ í¬ì¸íŠ¸
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_referral_codes_code ON referral_codes(code);
CREATE INDEX idx_referral_codes_owner ON referral_codes(owner_type, owner_id);
```

#### 11. weekly_reads (ìœ„í´ë¦¬ ì½ê¸° ì´ë ¥)

```sql
CREATE TABLE weekly_reads (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  edition_id TEXT NOT NULL, -- ë°œí–‰ë¬¼ ID (YYYY-MM-DD)
  read_completed BOOLEAN DEFAULT false, -- ëê¹Œì§€ ì½ì—ˆëŠ”ì§€
  points_earned INTEGER DEFAULT 0, -- íšë“í•œ í¬ì¸íŠ¸
  read_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id, edition_id) -- ì¤‘ë³µ ì½ê¸° ë°©ì§€
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_weekly_reads_user_id ON weekly_reads(user_id);
CREATE INDEX idx_weekly_reads_edition_id ON weekly_reads(edition_id);
```

### íŠ¸ë¦¬ê±° ë° í•¨ìˆ˜

#### í¬ì¸íŠ¸ ìë™ ì—…ë°ì´íŠ¸ íŠ¸ë¦¬ê±°

```sql
-- í¬ì¸íŠ¸ ë¡œê·¸ ì¶”ê°€ ì‹œ ì‚¬ìš©ì ì´ í¬ì¸íŠ¸ ìë™ ì—…ë°ì´íŠ¸
CREATE OR REPLACE FUNCTION update_user_total_points()
RETURNS TRIGGER AS $$
BEGIN
  UPDATE users
  SET total_points = (
    SELECT COALESCE(SUM(amount), 0)
    FROM point_logs
    WHERE user_id = NEW.user_id
  )
  WHERE id = NEW.user_id;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_user_points
AFTER INSERT ON point_logs
FOR EACH ROW
EXECUTE FUNCTION update_user_total_points();
```

#### ë ˆë²¨ ìë™ ì—…ê·¸ë ˆì´ë“œ í•¨ìˆ˜

```sql
-- í¬ì¸íŠ¸ì— ë”°ë¼ ë ˆë²¨ ìë™ ì—…ê·¸ë ˆì´ë“œ
CREATE OR REPLACE FUNCTION update_user_level()
RETURNS TRIGGER AS $$
BEGIN
  UPDATE users
  SET current_level = CASE
    WHEN total_points >= 10000 THEN 'platinum'
    WHEN total_points >= 5000 THEN 'gold'
    WHEN total_points >= 2000 THEN 'silver'
    ELSE 'bronze'
  END
  WHERE id = NEW.user_id;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_user_level
AFTER UPDATE OF total_points ON users
FOR EACH ROW
WHEN (NEW.total_points <> OLD.total_points)
EXECUTE FUNCTION update_user_level();
```

---

## API ì„¤ê³„

### ì¸ì¦ API

#### POST /auth/kakao
ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸

**Request:**
```json
{
  "access_token": "ì¹´ì¹´ì˜¤ ì•¡ì„¸ìŠ¤ í† í°"
}
```

**Response:**
```json
{
  "success": true,
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "name": "í™ê¸¸ë™",
    "academy_name": "ë„¥ì†Œí•™ì›",
    "role": "subscriber",
    "total_points": 1500,
    "current_level": "silver"
  },
  "session": {
    "access_token": "supabase_access_token",
    "refresh_token": "supabase_refresh_token"
  }
}
```

#### POST /auth/logout
ë¡œê·¸ì•„ì›ƒ

**Response:**
```json
{
  "success": true
}
```

### í¬ì¸íŠ¸ API

#### GET /points/history
í¬ì¸íŠ¸ ë‚´ì—­ ì¡°íšŒ

**Query Parameters:**
- `page`: í˜ì´ì§€ ë²ˆí˜¸ (ê¸°ë³¸ê°’: 1)
- `limit`: í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜ (ê¸°ë³¸ê°’: 20)

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "amount": 100,
      "action_type": "read_weekly",
      "description": "ìœ„í´ë¦¬ ì½ê¸°",
      "created_at": "2026-02-05T10:00:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 45,
    "total_pages": 3
  }
}
```

#### POST /points/earn
í¬ì¸íŠ¸ ì ë¦½ (ì‹œìŠ¤í…œ ìë™ í˜¸ì¶œ)

**Request:**
```json
{
  "action_type": "read_weekly",
  "description": "ìœ„í´ë¦¬ ì½ê¸° ì™„ë£Œ",
  "related_id": "2026-02-05"
}
```

**Response:**
```json
{
  "success": true,
  "points_earned": 100,
  "total_points": 1600
}
```

### ê²Œì‹œíŒ API

#### GET /posts
ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ

**Query Parameters:**
- `type`: ê²Œì‹œê¸€ íƒ€ì… ('review', 'community', 'question')
- `page`: í˜ì´ì§€ ë²ˆí˜¸
- `limit`: í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜
- `sort`: ì •ë ¬ ë°©ì‹ ('latest', 'popular', 'best')

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "type": "review",
      "title": "ë„¥ì†Œ ì „ìì¹ íŒ í›„ê¸°",
      "content": "ì •ë§ ì¢‹ìŠµë‹ˆë‹¤...",
      "author": {
        "id": "uuid",
        "name": "í™ê¸¸ë™",
        "academy_name": "ë„¥ì†Œí•™ì›"
      },
      "is_verified": true,
      "is_best": false,
      "likes_count": 15,
      "comments_count": 5,
      "created_at": "2026-02-05T10:00:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 100
  }
}
```

#### POST /posts
ê²Œì‹œê¸€ ì‘ì„±

**Request:**
```json
{
  "type": "review",
  "title": "ë„¥ì†Œ ì „ìì¹ íŒ í›„ê¸°",
  "content": "ì •ë§ ì¢‹ìŠµë‹ˆë‹¤...",
  "images": ["url1", "url2"]
}
```

**Response:**
```json
{
  "success": true,
  "post": {
    "id": "uuid",
    "type": "review",
    "title": "ë„¥ì†Œ ì „ìì¹ íŒ í›„ê¸°",
    "points_earned": 500
  }
}
```

### ë‹¤ìš´ë¡œë“œ API

#### GET /downloads/files
êµ¬ë…ì ì „ìš© íŒŒì¼ ëª©ë¡

**Response:**
```json
{
  "success": true,
  "files": [
    {
      "id": "uuid",
      "name": "ìƒë‹´ì¼ì§€ í…œí”Œë¦¿.xlsx",
      "category": "premium",
      "file_type": "excel",
      "file_size": 1024000,
      "download_url": "/downloads/premium/ìƒë‹´ì¼ì§€_í…œí”Œë¦¿.xlsx",
      "is_available": true
    }
  ]
}
```

#### POST /downloads/download
íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ì´ë ¥ ê¸°ë¡)

**Request:**
```json
{
  "file_id": "uuid"
}
```

**Response:**
```json
{
  "success": true,
  "download_url": "signed_url",
  "expires_at": "2026-02-05T11:00:00Z"
}
```

### ì£¼ë¬¸ API

#### POST /orders
ì£¼ë¬¸/ìƒë‹´ ì‹ ì²­

**Request:**
```json
{
  "customer_name": "í™ê¸¸ë™",
  "academy_name": "ë„¥ì†Œí•™ì›",
  "phone": "010-1234-5678",
  "email": "user@example.com",
  "referrer_code": "STAFF001",
  "product_interest": "ì „ìì¹ íŒ",
  "size": "75",
  "mount_type": "wall",
  "quantity": 2
}
```

**Response:**
```json
{
  "success": true,
  "order": {
    "id": "uuid",
    "status": "pending",
    "total_price": 5500000,
    "discount_amount": 500000,
    "discount_reason": "êµ¬ë…ì íŠ¹ê°€"
  }
}
```

### ì´ë²¤íŠ¸ API

#### GET /events
ì´ë²¤íŠ¸ ëª©ë¡

**Response:**
```json
{
  "success": true,
  "events": [
    {
      "id": "uuid",
      "title": "ì•„ì´íŒ¨ë“œ ì´ë²¤íŠ¸",
      "entry_cost_points": 1000,
      "max_entries": 100,
      "prize_description": "ì•„ì´íŒ¨ë“œ ì—ì–´ 1ëŒ€",
      "start_date": "2026-02-01T00:00:00Z",
      "end_date": "2026-02-28T23:59:59Z",
      "status": "active",
      "my_entry": {
        "entered": true,
        "entry_date": "2026-02-05T10:00:00Z"
      }
    }
  ]
}
```

#### POST /events/:id/enter
ì´ë²¤íŠ¸ ì‘ëª¨

**Response:**
```json
{
  "success": true,
  "entry": {
    "id": "uuid",
    "points_used": 1000,
    "remaining_points": 500
  }
}
```

---

## ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬

### ì¸ì¦ í”Œë¡œìš°

```
1. ì‚¬ìš©ìê°€ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­
   â†“
2. ì¹´ì¹´ì˜¤ ì¸ì¦ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
   â†“
3. ì‚¬ìš©ì ì¸ì¦ ì™„ë£Œ í›„ ì•¡ì„¸ìŠ¤ í† í° ë°œê¸‰
   â†“
4. ì•¡ì„¸ìŠ¤ í† í°ì„ Supabase Auth APIë¡œ ì „ì†¡
   â†“
5. Supabaseê°€ ì¹´ì¹´ì˜¤ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
   â†“
6. users í…Œì´ë¸”ì— íšŒì› ì •ë³´ ì €ì¥/ì—…ë°ì´íŠ¸
   â†“
7. Supabase ì„¸ì…˜ í† í° ë°œê¸‰
   â†“
8. í´ë¼ì´ì–¸íŠ¸ì— ì„¸ì…˜ ì €ì¥ (localStorage)
```

### ê¶Œí•œ ë ˆë²¨

#### subscriber (êµ¬ë…ì)
- ê¸°ë³¸ íšŒì›
- êµ¬ë…ì ì „ìš© ìë£Œ ë‹¤ìš´ë¡œë“œ
- ê²Œì‹œíŒ ì‘ì„±/ëŒ“ê¸€
- í¬ì¸íŠ¸ ì ë¦½/ì‚¬ìš©
- ì´ë²¤íŠ¸ ì‘ëª¨

#### verified_buyer (êµ¬ë§¤ ì¸ì¦ íšŒì›)
- êµ¬ë§¤ ì™„ë£Œ íšŒì›
- subscriber ê¶Œí•œ + êµ¬ë§¤ ì¸ì¦ ë§ˆí¬
- ë² ìŠ¤íŠ¸ í›„ê¸° ì„ ì • ê°€ëŠ¥

#### admin (ê´€ë¦¬ì)
- ëª¨ë“  ê¶Œí•œ
- ê²Œì‹œê¸€ ê´€ë¦¬
- ì´ë²¤íŠ¸ ê´€ë¦¬
- í†µê³„ ì¡°íšŒ

### ì„¸ì…˜ ê´€ë¦¬

- **ì €ì¥ ìœ„ì¹˜**: localStorage
- **í† í° íƒ€ì…**: JWT (Supabase)
- **ë§Œë£Œ ì‹œê°„**: 7ì¼ (ìë™ ê°±ì‹ )
- **ë¡œê·¸ì•„ì›ƒ**: í† í° ì‚­ì œ

---

## í¬ì¸íŠ¸ ì‹œìŠ¤í…œ ìƒì„¸ ì„¤ê³„

### í¬ì¸íŠ¸ ì ë¦½ ê·œì¹™

| ì•¡ì…˜ | í¬ì¸íŠ¸ | ì¡°ê±´ |
|------|--------|------|
| íšŒì›ê°€ì… | +1,000 | ìµœì´ˆ 1íšŒë§Œ |
| ìœ„í´ë¦¬ ì½ê¸° | +100 | ëê¹Œì§€ ìŠ¤í¬ë¡¤ ì™„ë£Œ |
| í›„ê¸° ì‘ì„± | +500 | ê¸°ë³¸ |
| í›„ê¸° ì‘ì„± (ì‚¬ì§„ í¬í•¨) | +1,000 | ì‚¬ì§„ 1ì¥ ì´ìƒ |
| ëŒ“ê¸€ ì‘ì„± | +50 | ê¸°ë³¸ |
| ë² ìŠ¤íŠ¸ í›„ê¸° ì„ ì • | +2,000 | ê´€ë¦¬ì ì„ ì • |
| ì´ë²¤íŠ¸ ë‹¹ì²¨ | +5,000 | ê²½í’ˆ ìˆ˜ë ¹ ì‹œ |

### í¬ì¸íŠ¸ ì‚¬ìš©ì²˜

| í•­ëª© | ë¹„ìš© | ì œí•œ |
|------|------|------|
| ì´ë²¤íŠ¸ ì‘ëª¨ | 1,000P | ì´ë²¤íŠ¸ë³„ 1íšŒ |
| ë ˆë²¨ ì—…ê·¸ë ˆì´ë“œ | - | ìë™ (í¬ì¸íŠ¸ ê¸°ì¤€) |

### ë ˆë²¨ ì‹œìŠ¤í…œ

| ë ˆë²¨ | í•„ìš” í¬ì¸íŠ¸ | í˜œíƒ |
|------|------------|------|
| Bronze | 0-1,999 | ê¸°ë³¸ ìë£Œ ë‹¤ìš´ë¡œë“œ |
| Silver | 2,000-4,999 | í”„ë¦¬ë¯¸ì—„ ìë£Œ ì¼ë¶€ |
| Gold | 5,000-9,999 | í”„ë¦¬ë¯¸ì—„ ìë£Œ ì „ì²´ |
| Platinum | 10,000+ | íŠ¹ë³„ í˜œíƒ + ìš°ì„  ìƒë‹´ |

---

## ì•Œë¦¼ ì‹œìŠ¤í…œ ì„¤ê³„

### ì•Œë¦¼ íƒ€ì…

1. **ìœ„í´ë¦¬ ë°œí–‰ ì•Œë¦¼** (ë§¤ì£¼ ëª©ìš”ì¼)
   - ë°œí–‰ë¬¼ ì œëª©
   - ì£¼ìš” ë‚´ìš© ìš”ì•½
   - ë§í¬

2. **í¬ì¸íŠ¸ ì ë¦½ ì•Œë¦¼** (ì‹¤ì‹œê°„)
   - ì ë¦½ í¬ì¸íŠ¸
   - ì ë¦½ ì‚¬ìœ 
   - ì´ í¬ì¸íŠ¸

3. **ì´ë²¤íŠ¸ ì•Œë¦¼** (ì„ íƒ)
   - ìƒˆ ì´ë²¤íŠ¸ ì‹œì‘
   - ë‹¹ì²¨ ë°œí‘œ

4. **ëŒ“ê¸€ ì•Œë¦¼** (ì„ íƒ)
   - ë‚´ ê²Œì‹œê¸€ì— ëŒ“ê¸€ ë‹¬ë¦¼

### ì•Œë¦¼ ë°œì†¡ í”Œë¡œìš°

```
1. ì´ë²¤íŠ¸ ë°œìƒ (ë°œí–‰, í¬ì¸íŠ¸ ì ë¦½ ë“±)
   â†“
2. Supabase Trigger ì‹¤í–‰
   â†“
3. Edge Function í˜¸ì¶œ
   â†“
4. ì•Œë¦¼í†¡ API í˜¸ì¶œ (Solapi)
   â†“
5. ë°œì†¡ ì™„ë£Œ ë¡œê·¸ ê¸°ë¡
```

### ì•Œë¦¼ ì„¤ì • ê´€ë¦¬

- ì‚¬ìš©ìê°€ ì•Œë¦¼ ìˆ˜ì‹  ë°©ë²• ì„ íƒ (SMS/ì¹´ì¹´ì˜¤í†¡/ì´ë©”ì¼)
- ì•Œë¦¼ íƒ€ì…ë³„ on/off ì„¤ì •
- ì•Œë¦¼ ë‚´ì—­ ì¡°íšŒ

---

## íŒŒì¼ ì—…ë¡œë“œ ë° ìŠ¤í† ë¦¬ì§€

### íŒŒì¼ êµ¬ì¡°

```
Supabase Storage
â”œâ”€â”€ premium/
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”œâ”€â”€ ìƒë‹´ì¼ì§€_í…œí”Œë¦¿.xlsx
â”‚   â”‚   â””â”€â”€ ìˆ˜ì—…ê³„íšì„œ_í…œí”Œë¦¿.xlsx
â”‚   â””â”€â”€ guides/
â”‚       â””â”€â”€ í•™ì›ìš´ì˜_ê°€ì´ë“œ.pdf
â”œâ”€â”€ reviews/
â”‚   â””â”€â”€ {post_id}/
â”‚       â”œâ”€â”€ image1.jpg
â”‚       â””â”€â”€ image2.jpg
â””â”€â”€ events/
    â””â”€â”€ {event_id}/
        â””â”€â”€ banner.jpg
```

### ì ‘ê·¼ ì œì–´

- **premium/**: êµ¬ë…ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
- **reviews/**: ê²Œì‹œê¸€ ì‘ì„±ì + ê´€ë¦¬ì
- **events/**: ê³µê°œ (ëª¨ë“  ì‚¬ìš©ì)

### íŒŒì¼ ì—…ë¡œë“œ í”Œë¡œìš°

```
1. ì‚¬ìš©ìê°€ íŒŒì¼ ì„ íƒ
   â†“
2. í´ë¼ì´ì–¸íŠ¸ì—ì„œ íŒŒì¼ ê²€ì¦ (í¬ê¸°, í˜•ì‹)
   â†“
3. Supabase Storageì— ì—…ë¡œë“œ
   â†“
4. ì—…ë¡œë“œëœ URLì„ DBì— ì €ì¥
   â†“
5. ë‹¤ìš´ë¡œë“œ ì‹œ ì„œëª…ëœ URL ìƒì„± (ë§Œë£Œ ì‹œê°„ ì„¤ì •)
```

---

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### ë°ì´í„° ë³´í˜¸
- ëª¨ë“  API ìš”ì²­ì— ì¸ì¦ í† í° í•„ìš”
- ë¯¼ê° ì •ë³´ëŠ” í™˜ê²½ ë³€ìˆ˜ë¡œ ê´€ë¦¬
- SQL Injection ë°©ì§€ (Supabase ìë™ ì²˜ë¦¬)

### íŒŒì¼ ë³´ì•ˆ
- íŒŒì¼ ì—…ë¡œë“œ ì‹œ ë°”ì´ëŸ¬ìŠ¤ ìŠ¤ìº” (ì„ íƒì‚¬í•­)
- íŒŒì¼ í¬ê¸° ì œí•œ
- í—ˆìš©ëœ íŒŒì¼ í˜•ì‹ë§Œ ì—…ë¡œë“œ

### ì‚¬ìš©ì ë°ì´í„°
- ê°œì¸ì •ë³´ ì•”í˜¸í™” ì €ì¥
- GDPR ì¤€ìˆ˜ (ê°œì¸ì •ë³´ ì‚­ì œ ìš”ì²­ ì²˜ë¦¬)

---

**ì‘ì„±ì¼**: 2026ë…„ 2ì›”  
**ë²„ì „**: 1.0  
**ì‘ì„±ì**: NEXO Platform ê°œë°œíŒ€

Â© 2026 ì£¼ì‹íšŒì‚¬ ë„¥ì†Œ (NEXO). All rights reserved.


