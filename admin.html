<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXO Weekly - 관리자 에디터</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>
    <!-- 로그인 화면 -->
    <div id="login-screen" class="login-screen">
        <div class="login-box">
            <h1>🔐 관리자 로그인</h1>
            <p class="login-subtitle">NEXO Weekly 발행물 관리 시스템</p>
            <form id="login-form">
                <div class="form-group">
                    <label for="admin-password">비밀번호</label>
                    <input type="password" id="admin-password" placeholder="관리자 비밀번호를 입력하세요" required>
                </div>
                <button type="submit" class="btn-primary">로그인</button>
            </form>
            <p class="login-note">기본 비밀번호는 설정 파일에서 변경할 수 있습니다.</p>
        </div>
    </div>

    <!-- 관리자 에디터 -->
    <div id="admin-editor" class="admin-editor" style="display: none;">
        <header class="admin-header">
            <h1>📝 NEXO Weekly 관리자</h1>
            <div class="admin-actions">
                <button id="logout-btn" class="btn-secondary">로그아웃</button>
                <a href="index.html" class="btn-secondary" target="_blank">사이트 보기</a>
            </div>
        </header>
        
        <!-- 탭 메뉴 -->
        <div class="admin-tabs">
            <button class="admin-tab active" data-tab="editor">📝 발행물 작성</button>
            <button class="admin-tab" data-tab="qrcode">📱 QR 코드 생성</button>
            <button class="admin-tab" data-tab="stats">📊 유입 통계</button>
        </div>

        <div class="admin-container">
            <div class="editor-wrapper">
                <!-- 발행물 작성 섹션 -->
                <div id="tab-editor" class="tab-content active">
                <div class="editor-section">
                    <div class="editor-header">
                        <h2>✍️ 발행물 작성</h2>
                        <p class="editor-hint">네이버 블로그처럼 자유롭게 작성하세요. 텍스트와 이미지만 입력하면 자동으로 웹사이트 형식에 맞게 변환됩니다.</p>
                    </div>

                    <form id="edition-form" class="edition-form">
                        <!-- 기본 정보 (최소한만) -->
                        <div class="form-section simple-section">
                            <div class="form-grid-2">
                                <div class="form-group">
                                    <label for="edition-date">발행일 (목요일) *</label>
                                    <input type="date" id="edition-date" required>
                                </div>
                                <div class="form-group">
                                    <label for="edition-title">제목 *</label>
                                    <input type="text" id="edition-title" placeholder="예: 목요일엔 넥소! 🏢 스마트 오피스의 시작" required>
                                </div>
                            </div>
                        </div>

                        <!-- 리치 텍스트 에디터 -->
                        <div class="form-section editor-content-section">
                            <label for="content-editor" class="editor-label">내용 작성 *</label>
                            <div class="editor-toolbar">
                                <button type="button" class="toolbar-btn" onclick="insertText('✅ ', 'content-editor')" title="체크리스트">✅</button>
                                <button type="button" class="toolbar-btn" onclick="insertText('🏆 ', 'content-editor')" title="업적">🏆</button>
                                <button type="button" class="toolbar-btn" onclick="insertText('💡 ', 'content-editor')" title="팁">💡</button>
                                <button type="button" class="toolbar-btn" onclick="insertText('📞 ', 'content-editor')" title="연락처">📞</button>
                                <button type="button" class="toolbar-btn" onclick="insertText('🌐 ', 'content-editor')" title="웹사이트">🌐</button>
                                <span class="toolbar-separator">|</span>
                                <button type="button" class="toolbar-btn" onclick="insertText('\n\n', 'content-editor')" title="줄바꿈">줄바꿈</button>
                            </div>
                            <textarea 
                                id="content-editor" 
                                class="content-editor"
                                placeholder="예시:&#10;&#10;[목요일엔 넥소! 🏢 스마트 오피스의 시작]&#10;&#10;대표님, 우리 회사 회의실 풍경은 어떤가요? 흐릿한 빔프로젝터, 지우기 바쁜 화이트보드, 복잡한 케이블... 🤯&#10;이제 넥소(NEXO) 전자칠판 하나로 스마트하게 바꾸세요!&#10;&#10;✅ All-in-One 솔루션: PC + 모니터 + 칠판 + 카메라가 하나로 통합되었습니다.&#10;✅ 압도적 화질: 4K UHD 해상도로 작은 글씨도 선명하게, 4,800만 화소 AI 카메라로 화상 회의도 완벽하게 지원합니다.&#10;✅ 무선 미러링: 노트북, 태블릿, 스마트폰 등 최대 9대 기기를 선 없이 동시에 연결하세요.&#10;&#10;🏆 검증된 실적: 메가스터디, 종로학원 등 전국 학원 납품 1위, 소상공인진흥공단 기술 공급 1위의 기술력으로 만듭니다.&#10;&#10;💡 톡방 멤버 특별 제안: 사무실 이전을 앞두고 계시거나, 스마트한 회의 환경이 필요하신 대표님들은 편하게 문의 주세요.&#10;&#10;📞 문의: (전화번호 기재)&#10;🌐 홈페이지: www.nexokorea.com"
                                required></textarea>
                            <div class="editor-footer">
                                <small>💡 팁: 이모지와 특수 기호를 사용하면 자동으로 구조화됩니다. ✅는 업데이트, 🏆는 업적, 💡는 특별 제안으로 인식됩니다.</small>
                            </div>
                        </div>

                        <!-- 이미지 업로드 (간단하게) -->
                        <div class="form-section image-section">
                            <label class="editor-label">이미지 등록 (최대 3개)</label>
                            <div class="image-upload-simple">
                                <div class="image-upload-box" id="image-box-1">
                                    <input type="file" id="image-1" accept="image/*" class="image-input-hidden" data-index="1">
                                    <div class="image-preview-simple" id="preview-1">
                                        <div class="image-placeholder-simple">
                                            <span class="placeholder-icon">📷</span>
                                            <span class="placeholder-text">Hero 이미지<br>(상단 큰 이미지)</span>
                                        </div>
                                    </div>
                                    <input type="text" id="image-1-filename" placeholder="파일명 (자동 입력)" class="image-filename-input" readonly>
                                </div>
                                <div class="image-upload-box" id="image-box-2">
                                    <input type="file" id="image-2" accept="image/*" class="image-input-hidden" data-index="2">
                                    <div class="image-preview-simple" id="preview-2">
                                        <div class="image-placeholder-simple">
                                            <span class="placeholder-icon">📷</span>
                                            <span class="placeholder-text">이미지 2<br>(선택사항)</span>
                                        </div>
                                    </div>
                                    <input type="text" id="image-2-filename" placeholder="파일명" class="image-filename-input" readonly>
                                </div>
                                <div class="image-upload-box" id="image-box-3">
                                    <input type="file" id="image-3" accept="image/*" class="image-input-hidden" data-index="3">
                                    <div class="image-preview-simple" id="preview-3">
                                        <div class="image-placeholder-simple">
                                            <span class="placeholder-icon">📷</span>
                                            <span class="placeholder-text">이미지 3<br>(선택사항)</span>
                                        </div>
                                    </div>
                                    <input type="text" id="image-3-filename" placeholder="파일명" class="image-filename-input" readonly>
                                </div>
                            </div>
                            <div class="image-note-simple">
                                <p>📸 이미지 파일을 선택하면 파일명이 자동으로 입력됩니다. 선택한 파일을 <code>assets/images/</code> 폴더에 복사하는 것을 잊지 마세요!</p>
                            </div>
                        </div>

                        <!-- 제출 버튼 -->
                        <div class="form-actions">
                            <button type="submit" class="btn-primary btn-large">✅ 발행물 등록</button>
                            <button type="button" class="btn-secondary" onclick="previewParsed()">👁️ 미리보기</button>
                        </div>
                    </form>
                </div>

                <!-- 미리보기 패널 (선택사항) -->
                <div class="preview-panel" id="preview-panel" style="display: none;">
                    <h3>📋 자동 파싱 결과 미리보기</h3>
                    <div id="parsed-preview"></div>
                </div>
                </div>
                </div>
                
                <!-- QR 코드 생성 섹션 -->
                <div id="tab-qrcode" class="tab-content" style="display: none;">
                    <div class="editor-section">
                        <div class="editor-header">
                            <h2>📱 QR 코드 생성 도구</h2>
                            <p class="editor-hint">기사님별 고유 QR 코드를 생성하여 오프라인 홍보에 활용하세요. QR 코드를 스캔한 사용자가 가입/주문 시 유입 경로가 자동으로 기록됩니다.</p>
                        </div>
                        
                        <div class="qrcode-generator">
                            <div class="form-section">
                                <div class="form-group">
                                    <label for="qrcode-owner-name">소유자 이름 *</label>
                                    <input type="text" id="qrcode-owner-name" placeholder="예: 홍길동 기사님" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="qrcode-owner-type">소유자 유형 *</label>
                                    <select id="qrcode-owner-type" required>
                                        <option value="">선택하세요</option>
                                        <option value="staff">기사님</option>
                                        <option value="partner">파트너</option>
                                        <option value="member">회원</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="qrcode-code">고유 코드 (선택사항)</label>
                                    <input type="text" id="qrcode-code" placeholder="예: STAFF001 (비워두면 자동 생성)">
                                    <small style="color: #666; font-size: 12px; display: block; margin-top: 4px;">
                                        비워두면 "OWNER-TYPE-이름" 형식으로 자동 생성됩니다
                                    </small>
                                </div>
                                
                                <button type="button" id="generate-qrcode-btn" class="btn-primary">QR 코드 생성</button>
                            </div>
                            
                            <div id="qrcode-library-info" class="qrcode-info" style="display: none;">
                                <h3>💡 QR 코드 생성 정보</h3>
                                <p>현재 <strong>온라인 API</strong>를 사용하여 QR 코드를 생성합니다.</p>
                                <div class="qrcode-info-details">
                                    <p><strong>장점:</strong></p>
                                    <ul>
                                        <li>라이브러리 파일 불필요</li>
                                        <li>즉시 사용 가능</li>
                                    </ul>
                                    <p><strong>참고:</strong></p>
                                    <ul>
                                        <li>인터넷 연결이 필요합니다</li>
                                        <li>오프라인 환경에서는 로컬 라이브러리 파일이 필요합니다</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div id="qrcode-result" class="qrcode-result" style="display: none;">
                                <h3>생성된 QR 코드</h3>
                                <div class="qrcode-display">
                                    <canvas id="qrcode-canvas"></canvas>
                                </div>
                                <div class="qrcode-info">
                                    <p><strong>코드:</strong> <span id="qrcode-result-code"></span></p>
                                    <p><strong>소유자:</strong> <span id="qrcode-result-owner"></span></p>
                                    <p><strong>URL:</strong> <span id="qrcode-result-url" style="word-break: break-all;"></span></p>
                                </div>
                                <div class="qrcode-actions">
                                    <button type="button" id="download-qrcode-btn" class="btn-primary">이미지 다운로드</button>
                                    <button type="button" id="copy-url-btn" class="btn-secondary">URL 복사</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 유입 통계 섹션 -->
                <div id="tab-stats" class="tab-content" style="display: none;">
                    <div class="editor-section">
                        <div class="editor-header">
                            <h2>📊 유입 경로 통계</h2>
                            <p class="editor-hint">기사님별 유입 현황을 확인하세요. Google Sheets에서 데이터를 불러옵니다.</p>
                        </div>
                        
                        <div class="stats-dashboard">
                            <div class="stats-controls">
                                <button type="button" id="refresh-stats-btn" class="btn-primary">🔄 데이터 새로고침</button>
                                <div class="stats-info">
                                    <p><small>💡 Google Sheets에서 최신 데이터를 불러옵니다. 환경 변수가 설정되어 있어야 합니다.</small></p>
                                </div>
                            </div>
                            
                            <div id="stats-loading" class="stats-loading" style="display: none;">
                                <p>데이터를 불러오는 중...</p>
                            </div>
                            
                            <div id="stats-error" class="stats-error" style="display: none;">
                                <p>❌ 데이터를 불러올 수 없습니다. Google Sheets 설정을 확인해주세요.</p>
                            </div>
                            
                            <div id="stats-content" class="stats-content" style="display: none;">
                                <div class="stats-summary">
                                    <div class="stat-card">
                                        <h3>총 주문 건수</h3>
                                        <p class="stat-number" id="total-orders">0</p>
                                    </div>
                                    <div class="stat-card">
                                        <h3>유입 경로 추적 건수</h3>
                                        <p class="stat-number" id="total-referrals">0</p>
                                    </div>
                                    <div class="stat-card">
                                        <h3>고유 유입 경로 수</h3>
                                        <p class="stat-number" id="unique-referrers">0</p>
                                    </div>
                                </div>
                                
                                <div class="stats-table-section">
                                    <h3>기사님별 유입 현황</h3>
                                    <div class="stats-table-wrapper">
                                        <table id="referrer-stats-table" class="stats-table">
                                            <thead>
                                                <tr>
                                                    <th>유입 경로</th>
                                                    <th>주문 건수</th>
                                                    <th>최근 주문일</th>
                                                </tr>
                                            </thead>
                                            <tbody id="referrer-stats-tbody">
                                                <!-- 동적으로 채워짐 -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 성공 메시지 -->
        <div id="success-message" class="success-message" style="display: none;">
            <div class="message-content">
                <span class="message-icon">✅</span>
                <h3>발행물이 성공적으로 등록되었습니다!</h3>
                <div id="success-details"></div>
            </div>
        </div>
    </div>

    <!-- QR 코드 라이브러리 (선택사항 - 있으면 사용, 없으면 온라인 API 사용) -->
    <script>
        // QR 코드 라이브러리 파일 존재 확인 (선택사항)
        (function() {
            // 파일 존재 여부를 먼저 확인 (404 에러 방지)
            fetch('js/qrcode.min.js', { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        // 파일이 있으면 로드
                        const script = document.createElement('script');
                        script.src = 'js/qrcode.min.js';
                        script.async = true;
                        script.onload = function() {
                            if (typeof QRCode !== 'undefined') {
                                console.log('✅ QR 코드 라이브러리 로드 완료 (로컬 파일)');
                            }
                        };
                        document.head.appendChild(script);
                    } else {
                        // 파일이 없으면 온라인 API 사용 (조용히)
                        console.log('💡 QR 코드: 온라인 API 사용 중');
                    }
                })
                .catch(() => {
                    // 네트워크 오류 등 - 온라인 API 사용
                    console.log('💡 QR 코드: 온라인 API 사용 중');
                });
        })();
    </script>
    <script src="js/admin-editor.js"></script>
    <script src="js/qrcode-generator.js"></script>
    <script src="js/stats-dashboard.js"></script>
</body>
</html>
